{% extends "posts/base.html" %}

{% block title %} {{ post.title }} {% endblock %}

{% block content %}
    <h1>{{ post.title }}</h1>
    <p class="date">
        Published {{ post.publish }} by {{ post.author }}
    </p>
    {{ post.text|linebreaks }}
    <hr>
    <p>
        <i>Tags: </i>
        {% for tag in post.tags.all %}
            <a href="{{ tag.get_absolute_url }}">{{ tag }}</a>{% if not forloop.last %},{% endif %}
        {% endfor %}   
    </p>
    <p>
        <a href="{% url 'posts:post_share' post.id %}"> Share this post.</a>
    </p>

    <hr>

        <h2> Similar posts</h2>
        <ul>
        {% for post in similar_posts %}
            <li>
                <a href="{{ post.get_absolute_url }}">{{ post.title }}</a>
            </li>
        {% empty %}
            There are no similar posts yet
        {% endfor %}
        </ul>
    <hr>

    {% with comments.count as total_comments %}
        <h3>
            {{ total_comments }} comment{{ total_comments|pluralize }}
        </h3>
    {% endwith %}
    {% for comment in comments %}
        <div class="card" style="border:none;margin:2px;">
            <div class="card-body">
            <p class="card-title">{{ comment.name }} <small class="text-muted">{{ comment.created|timesince }} ago</small></p>
            <p>{{ comment.text|linebreaks }}</p>
            <a href="#" class="card-link">Flag</a>
            <a href="#" class="card-link">share comment</a>
            </div>
        </div>
    {% empty %}
        <p>There are no comments yet.</p>
    {% endfor %}
    {% if new_comment %}
        <h3>Your comment has been added.</h3>
    {% else %}
    <div class="bg-light p-2">
        <h3>Add new comment</h3>
        <form action="" method="post">{% csrf_token %}
            {{ comment_form.as_p }}
            <button class="btn btn-primary" type="submit">Add comment</button>
        </form>
    </div>
    {% endif %}
    <hr>
{% endblock %}